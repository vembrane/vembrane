# as defined here: https://www.medizininformatik-initiative.de/Kerndatensatz/Modul_Molekulargenetischer_Befundbericht/Variante-Observation.html

__variables__:
  exon: ?ANN["EXON"]
  protein_position: ?ANN["Protein_position"]

resourceType: Observation

meta:
  profile:
  - https://www.medizininformatik-initiative.de/fhir/ext/modul-molgen/StructureDefinition/variante
  - http://hl7.org/fhir/uv/genomics-reporting/StructureDefinition/variant

code:
  coding:
  - code: 69548-6
    display: Genetic variant assessment
    system: http://loinc.org

category:
- coding:
  - code: laboratory
    display: Laboratory
    system: http://terminology.hl7.org/CodeSystem/observation-category

valueCodeableConcept:
  coding:
  - code: LA9633-4
    display: Present
    system: http://loinc.org

component:
- code:
    coding:
    - code: 48018-6
      display: Gene studied [ID]
      system: http://loinc.org
  valueCodeableConcept:
    coding:
    - code: ?ANN["HGNC_ID"]
      system: http://www.genenames.org/geneId
      display: ?ANN["SYMBOL"]
- code:
    coding:
    - code: 48013-7
      display: Genomic reference sequence [ID]
      system: http://loinc.org
  valueCodeableConcept:
    coding:
    - code: ?ANN["MANE"]
      system: http://www.ncbi.nlm.nih.gov/refseq
- code:
    coding:
    - code: 47999-8
      display: DNA region name [Identifier]
      system: http://loinc.org
  ?if exon.range.start == exon.range.stop:
    valueString: '?f"Exon #{ exon.range.start }"'
  ?else:
    valueString: '?f"Exon #{ exon.range.start } - #{ exon.range.stop }"'
- code:
    coding:
    - code: 47999-8
      display: DNA region name [Identifier]
      system: http://loinc.org
  valueString: '?f"Codon #{protein_position.start} - #{protein_position.end}"'
- code:
    coding:
    - code: 48004-6
      display: DNA change (c.HGVS)
      system: http://loinc.org
  valueCodeableConcept:
    coding:
    - code: ?ANN["HGVSc"]
      system: http://varnomen.hgvs.org
- code:
    coding:
    - code: 48005-3
      display: Amino acid change (pHGVS)
      system: http://loinc.org
  valueCodeableConcept:
    coding:
    - code: ?ANN["HGVSp"]
      system: http://varnomen.hgvs.org
- code:
    coding:
    - code: 81258-6
      display: Sample variant allelic frequency [NFr]
      system: http://loinc.org
  valueQuantity:
    code: '%'
    system: http://unitsofmeasure.org
    value: ?FORMAT['AF'][sample] * 100
- code:
    coding:
    - code: 48001-2
      display: Cytogenetic (chromosome) location
      system: http://loinc.org
  valueCodeableConcept:
    coding:
    - code: ?cytobands.get(CHROM, POS)
      system: urn:oid:2.16.840.1.113883.6.335
- code:
    coding:
    - code: 48006-1
      display: Amino acid change [Type]
      system: http://loinc.org
  valueCodeableConcept:
    coding:
    - code: LA6698-0
      display: ?ANN["Consequence"]
      system: http://loinc.org
- ?if ID is None: ?SKIP
  ?else:
    code:
      coding:
      - code: 81252-9
        display: Discrete genetic variant
        system: http://loinc.org
    valueCodeableConcept:
      coding:
      - code: ?ID
        system: http://www.ncbi.nlm.nih.gov/projects/SNP
